#!/usr/bin/env bash

appname="axel"
description="native messaging host file"
hostname=com.$appname.app
extension="pgidnjnhiaijnocmmmpmdddndnlckgcg"
releasedir="release"
datadir="data"
tempdir="$datadir/temp"
profiledir="$data/profile"
browser="google-chrome"

while [ -n "$1" ]; do
	e="`expr "$1" : '--\(.*=.*\)'`"
	keyname=`expr "$e" : '\(.*\)=.*' | sed 's/[^a-z0-9_]/_/g'`
	value=`expr "$e" : '.*=\(.*\)' | sed "s/'/_/g"`
	eval "$keyname='$value'"
	shift;
done

hostname=com.$appname.app

version=`$(which $browser) --version | cut -d " " -f3 | cut -d "." -f1`
if [ "$browser" != "google-chrome" ]; then
    version=`$(which $browser) --version | cut -d " " -f2 | cut -d "." -f1`
fi

cat<<EOF>build.settings
## Build settings, generated by configure

NAME="$appname"
DESCRIPTION="$description"
HOSTNAME="$hostname"
EXTENSION="$extension"
DIR="$(cd ../../;pwd)"
RELEASEDIR="$releasedir"
DATADIR="$datadir"
TEMPDIR="$datadir/temp"
PROFILEDIR="$datadir/profile"
BROWSER=$browser
CRVERSION=$version
CTFLAGS=("--no-first-run" "--prerender=enabled")
CRFLAGS=("--pack-extension=$releasedir")
if [ -e "$releasedir.pem" ]; then
    CRFLAGS+=("--pack-extension-key=$releasedir.pem")
fi

EOF

cat<<EOF>config.js
/* Extension settings, generated by configure */
var HOST_NAME = "$appname";
var HOST_ID = "$hostname";

EOF

echo Configuration done.
